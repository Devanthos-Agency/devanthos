---
import { ArrowUpRight } from 'lucide-react';
import { Badge } from '../ui/badge';
import { getCollection } from 'astro:content';
import { Separator } from '../ui/separator';
import Button from '../ui/Button.astro';

export const prerender = true;

const allPosts = await getCollection('blog');
const posts = allPosts
    .sort((a, b) => b.data.published.valueOf() - a.data.published.valueOf())
    .map((post) => ({
        id: post.id,
        title: post.data.title,
        summary: post.data.summary,
        label: post.data.label,
        author: post.data.author,
        published: post.data.published.toLocaleDateString('es-ES', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
        }),
        url: `/blog/${post.id}`,
        image: post.data.heroImage,
    }));
// Usar el primer post como featured post
const featuredPost = allPosts[0];
---

<section class="py-32">
    <div class="container mx-auto px-4">
        <div class="mb-16 text-center">
            <h1
                class="text-foreground font-cocogoose text-center text-5xl leading-tight [text-shadow:0_0_10px_rgba(255,255,255,0.65)] md:text-6xl lg:text-7xl">
                Blogs de Devanthos
            </h1>
            <p class="text-muted-foreground mx-auto mt-4 max-w-xl text-lg">
                Mantente actualizado con las Ãºltimas ideas, tendencias y consejos en diversos temas
                para mantenerte a la vanguardia.
            </p>
        </div>
        <div class="mx-auto max-w-7xl">
            {
                featuredPost && (
                    <div class="my-16 grid grid-cols-1 items-center gap-8 md:grid-cols-2 lg:gap-16">
                        <img
                            src={posts[0].image}
                            alt="placeholder"
                            class="aspect-video rounded-lg object-cover"
                            transition:name={`img${posts[0].id}`}
                        />
                        <div class="flex flex-col items-start gap-4">
                            <Badge variant="secondary" className="shrink">
                                {posts[0].label}
                            </Badge>
                            <h2 class="text-2xl font-semibold text-balance md:max-w-lg lg:text-3xl">
                                {posts[0].title}
                            </h2>
                            <p class="text-muted-foreground md:max-w-lg">{posts[0].summary}</p>
                            <Button href={posts[0].url}>
                                Read More <ArrowUpRight className="h-4 w-4" />
                            </Button>
                        </div>
                    </div>
                )
            }
            <div class="mt-20 grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                {
                    posts.map((post) => (
                        <a class="flex flex-col rounded-xl border" href={post.url}>
                            <div class="p-2">
                                <img
                                    src={post.image}
                                    alt={post.title}
                                    width="478"
                                    height="269"
                                    decoding="async"
                                    loading="lazy"
                                    class="aspect-video w-full rounded-lg object-cover"
                                    transition:name={`img${post.id}`}
                                />
                                <span class="sr-only">{post.summary}</span>
                            </div>
                            <div class="flex flex-1 flex-col px-3 pt-2 pb-4">
                                <h3 class="mb-1 font-medium">{post.title}</h3>
                                <p class="text-muted-foreground line-clamp-3 flex-1 text-sm">
                                    {post.summary}
                                </p>
                                <Separator className="my-5" />
                                <div class="flex items-center justify-between gap-4">
                                    <div class="flex items-center gap-3">
                                        <img
                                            src="/images/team/juan-morales.avif"
                                            alt="Avatar del autor"
                                            width="40"
                                            height="40"
                                            decoding="async"
                                            loading="lazy"
                                            class="size-10 rounded-full object-cover"
                                        />
                                        <span class="text-sm font-medium">{post.author}</span>
                                    </div>
                                    <Badge variant="secondary" className="h-fit">
                                        {' '}
                                        10 Min Read{' '}
                                    </Badge>
                                </div>
                            </div>
                        </a>
                    ))
                }
            </div>
        </div>
    </div>
</section>
