---
import { ArrowRight, FileText } from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import Button from '../ui/Button.astro';

import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const posts = allPosts
    .sort((a, b) => b.data.published.valueOf() - a.data.published.valueOf())
    .map((post) => ({
        id: post.id,
        title: post.data.title,
        summary: post.data.summary,
        label: post.data.label,
        author: post.data.author,
        published: post.data.published.toLocaleDateString('es-ES', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
        }),
        url: `/blog/${post.id}`,
        image: post.data.heroImage,
    }));
---

<section class="py-32">
    <div class="container mx-auto px-2">
        <div class="mx-auto flex max-w-3xl flex-col items-center gap-4 text-center">
            <Badge variant="outline" className="gap-1 py-1">
                <FileText className="h-full w-4" /> Nuestros Blogs
            </Badge>
            <h2 class="font-cocogoose text-4xl font-normal text-balance">
                Descubre las últimas tendencias
                <span class="sr-only"
                    >en desarrollo web, marketing digital, SEO y aplicaciones móviles</span
                >
            </h2>
            <p class="text-muted-foreground">
                Explora nuestro blog para encontrar artículos perspicaces, reflexiones personales e
                ideas que inspiran acción sobre los temas que te importan.
                <span class="sr-only"
                    >Guías técnicas sobre React, Next.js, chatbots, landing pages, apps móviles y
                    estrategias de marketing online.</span
                >
            </p>
        </div>
        <div class="mt-20 grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {
                posts.slice(0, 3).map((post) => (
                    <a class="rounded-xl border" href={post.url}>
                        <div class="p-2">
                            <img
                                src={post.image}
                                alt={post.title}
                                width="478"
                                height="269"
                                decoding="async"
                                loading="lazy"
                                class="aspect-video w-full rounded-lg object-cover"
                                transition:name={`img${post.id}`}
                            />
                            <span class="sr-only">{post.summary}</span>
                        </div>
                        <div class="flex flex-col px-3 pt-2 pb-4">
                            <h3 class="mb-1 font-medium">{post.title}</h3>
                            <p class="text-muted-foreground line-clamp-3 min-h-[60px] flex-grow text-sm">
                                {post.summary}
                            </p>
                            <Separator className="my-5" />
                            <div class="flex items-center justify-between gap-4">
                                <div class="flex items-center gap-3">
                                    <img
                                        src="/images/team/juan-morales.avif"
                                        alt="Avatar del autor"
                                        width="40"
                                        height="40"
                                        decoding="async"
                                        loading="lazy"
                                        class="size-10 rounded-full object-cover"
                                    />
                                    <span class="text-sm font-medium">{post.author}</span>
                                </div>
                                <Badge variant="secondary" className="h-fit">
                                    {' '}
                                    10 Min Read{' '}
                                </Badge>
                            </div>
                        </div>
                    </a>
                ))
            }
        </div>
        <div class="mt-10 flex justify-center">
            <Button href="/blog">
                Ver todos los blogs <ArrowRight className="ml-2 h-full w-4" />
            </Button>
        </div>
    </div>
</section>
